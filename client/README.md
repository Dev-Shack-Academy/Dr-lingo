# Frontend - React + TypeScript

React frontend for the Medical Translation Chat System.

## Tech Stack

- **React 19** - UI framework
- **TypeScript** - Type safety
- **Vite** - Build tool
- **Tailwind CSS** - Styling
- **Axios** - HTTP client with JWT handling
- **React Router** - Routing
- **WebSocket** - Real-time updates via Django Channels

## Quick Start

```bash
# Install dependencies
npm install

# Start development server
npm run dev

# Build for production
npm run build

# Preview production build
npm run preview
```

Development server runs at `http://localhost:5173`

## Project Structure

```
client/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                    # API layer
â”‚   â”‚   â”œâ”€â”€ HttpClient.ts      # Axios with JWT interceptors
â”‚   â”‚   â”œâ”€â”€ routes.ts          # API route constants
â”‚   â”‚   â””â”€â”€ services/          # API service classes
â”‚   â”‚       â”œâ”€â”€ AuthService.ts
â”‚   â”‚       â”œâ”€â”€ ChatService.ts
â”‚   â”‚       â””â”€â”€ CollectionService.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ components/             # React components
â”‚   â”‚   â”œâ”€â”€ auth/              # Authentication
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ UserMenu.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/             # Admin panel
â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeBaseManagement.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PatientContextManagement.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ChatRoomList.tsx
â”‚   â”‚   â”œâ”€â”€ TranslationChat.tsx  # Main chat with TTS playback
â”‚   â”‚   â”œâ”€â”€ MessageBubble.tsx
â”‚   â”‚   â””â”€â”€ PatientContextManager.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                  # Custom React hooks
â”‚   â”‚   â”œâ”€â”€ useWebSocket.ts    # Generic WebSocket hook
â”‚   â”‚   â”œâ”€â”€ useChatWebSocket.ts # Chat-specific WebSocket
â”‚   â”‚   â””â”€â”€ useAIConfig.ts     # AI configuration hook
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                  # TypeScript types
â”‚   â”‚   â”œâ”€â”€ websocket.ts       # WebSocket event types
â”‚   â”‚   â””â”€â”€ chat.ts            # Chat-related types
â”‚   â”‚
â”‚   â”œâ”€â”€ contexts/               # React contexts
â”‚   â”‚   â””â”€â”€ AuthContext.tsx    # Authentication state
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                  # Page components
â”‚   â”‚   â”œâ”€â”€ AuthPage.tsx
â”‚   â”‚   â””â”€â”€ TranslationChatPage.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ App.tsx                # Main app with routing
â”‚   â””â”€â”€ main.tsx               # Entry point
â”‚
â”œâ”€â”€ public/                     # Static assets
â”œâ”€â”€ index.html                 # HTML template
â”œâ”€â”€ vite.config.js             # Vite configuration
â”œâ”€â”€ tailwind.config.js         # Tailwind configuration
â””â”€â”€ tsconfig.json              # TypeScript configuration
```

## Features

### Authentication
- JWT-based authentication
- Automatic token refresh on 401 responses
- Protected routes for authenticated users
- Role-based UI (Patient, Doctor, Admin)

### Chat
- Real-time updates via WebSocket (Django Channels)
- Toast notification on connection loss
- Typing indicators
- Voice recording and transcription
- Toggle between original and translated text
- Audio playback for voice messages
- TTS (Text-to-Speech) playback for translated messages via "Listen" button

### Admin Panel
- User management (CRUD)
- Knowledge Base management
- Patient Context management with KB linking
- Chat room management

## Environment Variables

Create a `.env` file:

```env
VITE_API_URL=http://localhost:8000
```

## Commands

```bash
# Development
npm run dev

# Build
npm run build

# Lint
npm run lint

# Format
npm run format

# Type check
npm run typecheck
```

## API Integration

The frontend uses Axios with automatic JWT handling:

```typescript
// HttpClient automatically adds Authorization header
import { httpClient } from './api/HttpClient';

// All requests include JWT token
const response = await httpClient.get('/api/chat-rooms/');
```

### Token Refresh

When a 401 response is received, the client automatically:
1. Attempts to refresh the token
2. Retries the original request
3. Redirects to login if refresh fails

## User Roles

| Role | Access |
|------|--------|
| Patient | Chat, view own messages |
| Doctor | Chat, patient context, AI assistance |
| Admin | Full access, user management, collections |

## Styling

Uses Tailwind CSS with a black and white theme:

```jsx
// Example component styling
<div className="bg-white border border-gray-200 rounded-lg p-4">
  <h2 className="text-gray-900 font-semibold">Title</h2>
  <p className="text-gray-600">Content</p>
</div>
```

## TTS (Text-to-Speech) Playback

The chat interface includes TTS playback for translated messages:

- "Listen" button (ðŸ”Š) appears next to translated messages
- Audio generated by backend using Coqui TTS (XTTS v2)
- Different voices for doctor and patient messages
- Supports 17 languages including English, Spanish, French, German, etc.

```tsx
// TranslationChat.tsx - TTS playback
{message.tts_audio_url && (
  <button onClick={() => playAudio(message.tts_audio_url)}>
    ðŸ”Š Listen
  </button>
)}
```

## WebSocket Integration

The chat uses WebSocket for real-time updates with automatic reconnection:

```tsx
import { useChatWebSocket } from '../hooks/useChatWebSocket';

function ChatComponent({ roomId }) {
  const {
    status,           // 'connected' | 'connecting' | 'disconnected' | 'error'
    typingUsers,      // Users currently typing
    sendTyping,       // Send typing indicator
    sendStopTyping,   // Stop typing indicator
  } = useChatWebSocket({
    roomId,
    onNewMessage: (event) => { /* handle new message */ },
    onMessageTranslated: (event) => { /* handle translation */ },
    onMessageTranscribed: (event) => { /* handle transcription */ },
    onTTSGenerated: (event) => { /* handle TTS audio */ },
    onError: (message) => { /* show toast notification */ },
  });
}
```

### Connection Handling

- WebSocket connects automatically when entering a chat room
- Toast notification shown if connection is lost
- No polling fallback - WebSocket is the only real-time mechanism
- Automatic reconnection with exponential backoff

### WebSocket Events

| Event | Direction | Description |
|-------|-----------|-------------|
| `message.new` | Server â†’ Client | New message created |
| `message.translated` | Server â†’ Client | Translation complete |
| `message.transcribed` | Server â†’ Client | Audio transcribed |
| `tts.generated` | Server â†’ Client | TTS audio ready |
| `user.typing` | Bidirectional | Typing indicator |
| `ping` / `pong` | Bidirectional | Keep-alive |

## Resources

- [React Documentation](https://react.dev/)
- [Vite Documentation](https://vitejs.dev/)
- [Tailwind CSS](https://tailwindcss.com/)
- [TypeScript](https://www.typescriptlang.org/)
